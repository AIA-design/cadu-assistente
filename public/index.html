<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cadu - Assistente Pessoal</title>
</head>
<body>
<h1>Cadu</h1>
<input type="text" id="pergunta" placeholder="Fala ou digita aqui..." />
<button onclick="fazerPergunta()">Perguntar</button>
<button onclick="ativarMicrofone()">ðŸŽ¤ Falar</button>
<p id="resposta"></p>

<script>
async function fazerPergunta() {
    const pergunta = document.getElementById('pergunta').value;
    const respostaEl = document.getElementById('resposta');
    let resposta = "";

    try {
        const r = await fetch('/cadu', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ pergunta })
        });
        const data = await r.json();
        resposta = data.message;
    } catch(err) {
        resposta = "Opa, deu algum erro. Tenta de novo!";
        console.error(err);
    }

    respostaEl.innerText = resposta;

    const fala = new SpeechSynthesisUtterance(resposta);
    fala.lang = 'pt-BR';
    speechSynthesis.speak(fala);
}

// FunÃ§Ã£o para ativar microfone e transformar fala em texto
function ativarMicrofone() {
    const reconhecimento = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    reconhecimento.lang = 'pt-BR';
    reconhecimento.start();

    reconhecimento.onresult = function(event) {
        const texto = event.results[0][0].transcript;
        document.getElementById('pergunta').value = texto;
        fazerPergunta();
    };

    reconhecimento.onerror = function(event) {
        console.error('Erro no reconhecimento de fala:', event.error);
    };
}
</script>
</body>
</html>
