<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cadu Assistente</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
  #resposta { margin-top: 20px; font-weight: bold; min-height: 50px; }
  input, button { padding: 10px; margin: 5px; font-size: 16px; }
</style>
</head>
<body>
<h1>Cadu Assistente</h1>

<input type="text" id="pergunta" placeholder="Digite sua pergunta aqui">
<button id="enviar">Enviar</button>
<button id="microfone">ðŸŽ¤ Falar</button>

<div id="resposta"></div>

<script>
const perguntaInput = document.getElementById("pergunta");
const enviarBtn = document.getElementById("enviar");
const microfoneBtn = document.getElementById("microfone");
const respostaDiv = document.getElementById("resposta");

async function enviarPergunta(question) {
  respostaDiv.textContent = "Cadu estÃ¡ pensando...";
  try {
    const res = await fetch("/ask", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ question })
    });
    const data = await res.json();
    const resposta = data.answer || "Desculpe, nÃ£o consegui responder.";
    respostaDiv.textContent = resposta;

    // Fala a resposta
    const utter = new SpeechSynthesisUtterance(resposta);
    utter.lang = "pt-BR";
    speechSynthesis.speak(utter);
  } catch (err) {
    respostaDiv.textContent = "Erro ao consultar Cadu.";
    console.error(err);
  }
}

// Clique no botÃ£o enviar
enviarBtn.addEventListener("click", () => {
  const question = perguntaInput.value.trim();
  if (question) enviarPergunta(question);
});

// Microfone
microfoneBtn.addEventListener("click", () => {
  const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
  recognition.lang = "pt-BR";
  recognition.start();
  recognition.onresult = (event) => {
    const text = event.results[0][0].transcript;
    perguntaInput.value = text;
    enviarPergunta(text);
  };
  recognition.onerror = (err) => console.error("Erro no reconhecimento:", err);
});

// Enter envia
perguntaInput.addEventListener("keydown", (e) => {
  if (e.key === "Enter") enviarBtn.click();
});
</script>
</body>
</html>
