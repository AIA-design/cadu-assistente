<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cadu - Assistente Pessoal</title>
<style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    #resposta { margin-top: 20px; font-weight: bold; }
    button { margin-left: 10px; }
</style>
</head>
<body>
<h1>Cadu</h1>
<input type="text" id="pergunta" placeholder="Fala ou digita aqui..." />
<button onclick="fazerPergunta()">Perguntar</button>
<button onclick="falarComCadu()">ðŸŽ¤ Falar</button>
<p id="resposta"></p>

<script>
async function fazerPergunta() {
    const pergunta = document.getElementById('pergunta').value.trim();
    const respostaEl = document.getElementById('resposta');
    if (!pergunta) return;

    respostaEl.innerText = "Aguardando resposta do Cadu...";

    try {
        const r = await fetch('/cadu', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ pergunta })
        });

        const data = await r.json();

        if (data.message) {
            respostaEl.innerText = data.message;
            const fala = new SpeechSynthesisUtterance(data.message);
            fala.lang = 'pt-BR';
            speechSynthesis.speak(fala);
        } else {
            respostaEl.innerText = "Opa, nÃ£o consegui obter resposta.";
        }
    } catch (err) {
        console.error(err);
        respostaEl.innerText = "Opa, deu algum erro. Tenta de novo!";
    }
}

// FunÃ§Ã£o para usar o microfone
function falarComCadu() {
    if (!('webkitSpeechRecognition' in window || 'SpeechRecognition' in window)) {
        alert('Seu navegador nÃ£o suporta reconhecimento de voz.');
        return;
    }

    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = new SpeechRecognition();
    recognition.lang = 'pt-BR';
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;

    recognition.start();

    recognition.onresult = (event) => {
        const texto = event.results[0][0].transcript;
        document.getElementById('pergunta').value = texto;
        fazerPergunta();
    };

    recognition.onerror = (event) => {
        console.error('Erro no reconhecimento de voz:', event.error);
        alert('Erro ao capturar sua voz.');
    };
}
</script>
</body>
</html>
